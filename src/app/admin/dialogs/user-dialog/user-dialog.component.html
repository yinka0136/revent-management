<div class="d-flex justify-content-between" mat-dialog-title>
  <h4>
    {{ data.isEditing ? "Update User Details" : "Add User" }}
  </h4>
  <div class="click" mat-dialog-close>
    <img src="assets/icons/close.svg" alt="" />
  </div>
</div>
<mat-dialog-content class="mat-typography">
  <div class="wrapper">
    <form [formGroup]="userForm">
      <div class="row">
        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="name" class="form-label">First Name </label>
            <input
              type="text"
              id="firstname"
              class="form-control"
              formControlName="firstName"
              placeholder="Enter Your First Name"
              autocomplete="name"
              [ngClass]="{
                'is-invalid':
                  userForm.get('firstName')!.hasError('required') &&
                  (userForm.get('firstName')!.dirty ||
                    userForm.get('firstName')!.touched)
              }"
            />
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('firstName')?.hasError('required') &&
                (userForm.get('firstName')?.dirty ||
                  userForm.get('firstName')?.touched)
              "
              >Required</span
            >
          </div>
        </div>
        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="lastName" class="form-label">Last Name </label>
            <input
              type="text"
              id="lastName"
              class="form-control"
              placeholder="Enter Your Last Name"
              formControlName="lastName"
              autocomplete="name"
              [ngClass]="{
                'is-invalid':
                  userForm.get('lastName')!.hasError('required') &&
                  (userForm.get('lastName')!.dirty ||
                    userForm.get('lastName')!.touched)
              }"
            />
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('lastName')?.hasError('required') &&
                (userForm.get('lastName')?.dirty ||
                  userForm.get('lastName')?.touched)
              "
              >Required</span
            >
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="dob" class="form-label">Date Of Birth</label>
            <input
              type="date"
              id="dob"
              class="form-control"
              placeholder="Enter DOB"
              formControlName="dob"
              autocomplete="name"
              [ngClass]="{
                'is-invalid':
                  userForm.get('dob')!.hasError('required') &&
                  (userForm.get('dob')!.dirty || userForm.get('dob')!.touched)
              }"
            />
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('dob')?.hasError('required') &&
                (userForm.get('dob')?.dirty || userForm.get('dob')?.touched)
              "
              >Required</span
            >
          </div>
        </div>
        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="role" class="form-label">Role </label>
            <select
              id="role"
              class="form-control"
              formControlName="role"
              [ngClass]="{
                'is-invalid':
                  userForm.get('role')!.hasError('required') &&
                  (userForm.get('role')!.dirty || userForm.get('role')!.touched)
              }"
            >
              <option value="">-- select role --</option>
              <option value="{{ role }}" *ngFor="let role of ['admin', 'user']">
                {{ role }}
              </option>
              <span
                class="invalid-feedback"
                *ngIf="
                  userForm.get('role')?.hasError('required') &&
                  (userForm.get('role')?.dirty || userForm.get('role')?.touched)
                "
                >Required</span
              >
            </select>
          </div>
        </div>
        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="tel" class="form-label">Phone Number</label>
            <input
              type="tel"
              id="tel"
              class="form-control"
              placeholder="Enter Mobile Number"
              formControlName="phoneNumber"
              autocomplete="tel"
              [ngClass]="{
                'is-invalid':
                  (userForm.get('phoneNumber')!.hasError('required') &&
                    (userForm.get('phoneNumber')!.dirty ||
                      userForm.get('phoneNumber')!.touched)) ||
                  (userForm.get('phoneNumber')!.hasError('pattern') &&
                    !userForm.get('phoneNumber')!.hasError('required'))
              }"
            />
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('phoneNumber')?.hasError('required') &&
                (userForm.get('phoneNumber')?.dirty ||
                  userForm.get('phoneNumber')?.touched)
              "
              >Required</span
            >
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('phoneNumber')?.hasError('pattern') &&
                !userForm.get('phoneNumber')?.hasError('required')
              "
              >Please provide a valid phone number</span
            >
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-6">
          <div class="form_group">
            <label for="email" class="form-label">Email </label>
            <input
              type="email"
              id="email"
              class="form-control"
              placeholder="Enter Your Email Address"
              formControlName="email"
              autocomplete="email"
              [ngClass]="{
                'is-invalid':
                  (userForm.get('email')!.hasError('required') &&
                    (userForm.get('email')!.dirty ||
                      userForm.get('email')!.touched)) ||
                  (userForm.get('email')!.hasError('email') &&
                    !userForm.get('email')!.hasError('required'))
              }"
            />
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('email')?.hasError('required') &&
                (userForm.get('email')?.dirty || userForm.get('email')?.touched)
              "
              >Required</span
            >
            <span
              class="invalid-feedback"
              *ngIf="
                userForm.get('email')?.hasError('email') &&
                !userForm.get('email')?.hasError('required')
              "
              >Please provide a valid email address</span
            >
          </div>
        </div>
        <div class="col-12">
          <div class="form_group">
            <label for="address" class="form-label">Address </label>
            <textarea
              id="address"
              cols="30"
              placeholder="Address"
              rows="5"
              class="form-control"
              formControlName="address"
              [ngClass]="{
                'is-invalid':
                  userForm.get('address')!.hasError('required') &&
                  (userForm.get('address')!.dirty ||
                    userForm.get('address')!.touched)
              }"
            >
      <span
      class="invalid-feedback"
      *ngIf="
        userForm.get('address')?.hasError('required') &&
        (userForm.get('address')?.dirty || userForm.get('address')?.touched)
      "
      >Required</span
    >
    </textarea
            >
          </div>
        </div>

        <div class="col-12 col-md-6 col-lg-6" *ngIf="userForm.get('password')">
          <div class="form_group position-relative">
            <label for="password" class="form-label">password </label>
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              class="form-control"
              placeholder="Enter Password"
              formControlName="password"
              autocomplete="current-password"
              [ngClass]="{
                'is-invalid':
                  userForm.get('password')!.errors &&
                  (userForm.get('password')!.dirty ||
                    userForm.get('password')!.touched)
              }"
            />
            <img
              (click)="showPassword = !showPassword"
              src="assets/icons/eye-icon-{{
                showPassword ? 'open' : 'close'
              }}.svg"
              alt="eye close icon"
              class="svg_eye"
            />

            <span
              class="invalid-feedback"
              *ngIf="userForm.get('password')!.hasError('required')"
            >
              Password is required
            </span>
            <small
              class="invalid-feedback mt-2"
              *ngIf="
                userForm.get('password')!.dirty &&
                userForm.get('password')!.invalid
              "
            >
              *Your password must have at least
              <span
                *ngIf="
                  userForm.get('password')!.hasError('minlength') ||
                  userForm.get('password')!.hasError('required')
                "
                >8 characters,
              </span>
              <span
                *ngIf="
                  userForm.get('password')!.hasError('hasNumber') ||
                  userForm.get('password')!.hasError('required')
                "
                >1 number,</span
              >
              <span
                *ngIf="
                  userForm.get('password')!.hasError('hasCapitalCase') ||
                  userForm.get('password')!.hasError('required')
                "
              >
                1 capital letter,
              </span>
              <span
                *ngIf="
                  userForm.get('password')!.hasError('hasSmallCase') ||
                  userForm.get('password')!.hasError('required')
                "
              >
                1 small letter,
              </span>
              <span
                *ngIf="
                  userForm.get('password')!.hasError('hasSpecialCharacters') ||
                  userForm.get('password')!.hasError('required')
                "
              >
                and 1 special character.
              </span>
            </small>
          </div>
        </div>

        <div
          class="col-12 col-md-6 col-lg-6"
          *ngIf="userForm.get('confirmPassword')"
        >
          <div class="form_group position-relative">
            <label for="confirmPassword" class="form-label"
              >Confirm Password</label
            >
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              id="confirmPassword"
              class="form-control"
              placeholder="Create a secure password"
              formControlName="confirmPassword"
              (keyup)="checkForKeyEnter($event)"
              autocomplete="new-password"
              [ngClass]="{
                'is-invalid':
                  userForm.get('confirmPassword')!.dirty &&
                  userForm.get('confirmPassword')!.invalid
              }"
            />
            <img
              (click)="showConfirmPassword = !showConfirmPassword"
              src="assets/icons/eye-icon-{{
                showConfirmPassword ? 'open' : 'close'
              }}.svg"
              alt="eye close icon"
              class="svg_eye"
            />
            <small class="invalid-feedback mt-2">
              <span
                *ngIf="
                  (userForm.get('confirmPassword')!.hasError('required') ||
                    userForm
                      .get('confirmPassword')!
                      .hasError('NoPasswordMatch')) &&
                  (userForm.get('confirmPassword')!.dirty ||
                    userForm.get('confirmPassword')!.touched)
                "
              >
                Password Doesn't match
              </span>
            </small>
          </div>
        </div>
      </div>
    </form>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button
    #close
    mat-button
    mat-dialog-close
    class="btn btn_outlined btn_md me-4"
  >
    Cancel
  </button>

  <button
    (click)="submit()"
    class="btn_primary btn_md"
    [disabled]="isLoading$ | async"
    [title]="userForm.invalid ? 'pls input correct details' : 'Create Account '"
  >
    <span *ngIf="!(isLoading$ | async)">
      {{ data.isEditing ? "Update" : " Add User" }}
    </span>

    <app-global-loader
      [diameter]="20"
      [showLoader$]="isLoading$"
    ></app-global-loader>
  </button>
</mat-dialog-actions>
